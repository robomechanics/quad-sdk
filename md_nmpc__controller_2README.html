<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Quad-SDK: NMPC Controller</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Quad-SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">NMPC Controller</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Overview</h1>
<p>This package implements a nonlinear model predictive controller (NMPC) for agile quadrupedal navigation. The package produces ground reaction force (GRF) and body state plans which guide the robot from its current state to track the desired trajectory according to the contact schedule. The primary algorithm is collocation trajectory planning constructed by <a href="https://web.casadi.org/">CasADi</a> supporting multiple dynamics model (default is a centroidal dynamics one) and is solved by <a href="https://coin-or.github.io/Ipopt/">IPOPT</a> through a customed C++ interface to produce GRF plans considering contact schedule.</p>
<h2>License</h2>
<p>The source code is released under a <a href="quad-sdk/LICENSE">MIT License</a>.</p>
<p>**Author: Yanhao Yang<br  />
 Affiliation: <a href="https://www.cmu.edu/me/robomechanicslab/">Robomechanics Lab</a><br  />
 Maintainers: Yanhao Yang (<a href="#" onclick="location.href='mai'+'lto:'+'yan'+'ha'+'oy@'+'an'+'dre'+'w.'+'cmu'+'.e'+'du'; return false;">yanha<span class="obfuscator">.nosp@m.</span>oy@a<span class="obfuscator">.nosp@m.</span>ndrew<span class="obfuscator">.nosp@m.</span>.cmu<span class="obfuscator">.nosp@m.</span>.edu</a>), Joe Norby (<a href="#" onclick="location.href='mai'+'lto:'+'jno'+'rb'+'y@a'+'nd'+'rew'+'.c'+'mu.'+'ed'+'u'; return false;">jnorb<span class="obfuscator">.nosp@m.</span>y@an<span class="obfuscator">.nosp@m.</span>drew.<span class="obfuscator">.nosp@m.</span>cmu.<span class="obfuscator">.nosp@m.</span>edu</a>), and Jiming Ren (<a href="#" onclick="location.href='mai'+'lto:'+'jim'+'in'+'gre'+'@a'+'ndr'+'ew'+'.cm'+'u.'+'edu'; return false;">jimin<span class="obfuscator">.nosp@m.</span>gre@<span class="obfuscator">.nosp@m.</span>andre<span class="obfuscator">.nosp@m.</span>w.cm<span class="obfuscator">.nosp@m.</span>u.edu</a>)**</p>
<p>The NMPC Controller package has been tested under <a href="http://www.ros.org">ROS</a> Melodic 18.04. This is research code, expect that it changes often and any fitness for a particular purpose is disclaimed.</p>
<h2>Publications</h2>
<p>If you use this work in an academic context, please cite the following publication(s):</p>
<ul>
<li>J. Norby, Y. Yang, A. Tajbakhsh et al., “Quad-SDK,” 2022. [Online]. Available: <a href="https://github.com/robomechanics/quad-software">https://github.com/robomechanics/quad-software</a> (<a href="https://leggedrobots.org/assets/pdfs/paper22.pdf">paper</a>) <pre class="fragment">   @misc{norby2022quad, 
   title={{Quad-SDK}}, 
   url={https://github.com/robomechanics/quad-software}, 
   author={Norby, Joseph and Yang, Yanhao and Tajbakhsh, Ardalan and Ren, Jiming and Yim, Justin K. and Stutt, Alexandra and Yu, Qishun and Johnson, Aaron M.},
   year={2022}} 
</pre> <h2>Unit Tests</h2>
</li>
</ul>
<p>Run the unit tests with </p><pre class="fragment">catkin run_tests nmpc_controller
</pre> <h1>Usage</h1>
<p>It is a C++ class that can be included in other ROS packages.</p>
<h1>Config files</h1>
<ul>
<li><b>nmpc_controller.yaml</b> Sets NMPC hyperparameters.</li>
</ul>
<h3>Parameters</h3>
<ul>
<li><p class="startli">**<code>panic_weights</code>** (double, default: 200.0)</p>
<p class="startli">The linear panalty of the state panic variables.</p>
</li>
<li><p class="startli">**<code>constraint_panic_weights</code>** (double, default: 20.0)</p>
<p class="startli">The linear panalty of the constraint panic variables.</p>
</li>
<li><p class="startli">**<code>Q_temporal_factor</code>** (double, default: 10.0)</p>
<p class="startli">The temporal factor of the state cost weight.</p>
</li>
<li><p class="startli">**<code>R_temporal_factor</code>** (double, default: 1.0)</p>
<p class="startli">The temporal factor of the control cost weight.</p>
</li>
<li><p class="startli">**<code>friction_coefficient</code>** (double, default: 0.3)</p>
<p class="startli">The friction coefficient for GRF.</p>
</li>
<li><p class="startli">**<code>enable_variable_horizon</code>** (bool, default: false)</p>
<p class="startli">Turn on varialbe horzion or not.</p>
</li>
<li><p class="startli">**<code>min_horizon_length</code>** (int, default: 10)</p>
<p class="startli">Minimum horizon length when it's varaible.</p>
</li>
<li><p class="startli">**<code>enable_mixed_complexity</code>** (bool, default: false)</p>
<p class="startli">Enable mixed complexity or not</p>
</li>
<li><p class="startli">**<code>enable_adaptive_complexity</code>** (bool, default: false)</p>
<p class="startli">Enable adaptive complexity or not.</p>
</li>
<li><p class="startli">**<code>fixed_complex_idxs</code>** (vector, default: [])</p>
<p class="startli">Fixed complex finite element index.</p>
</li>
<li><p class="startli">**<code>fixed_complex_head</code>** (int, default: 0)</p>
<p class="startli">Fixed complex finite element number at the head.</p>
</li>
<li><p class="startli">**<code>fixed_complex_tail</code>** (int, default: 0)</p>
<p class="startli">Fixed complex finite element number at the tail.</p>
</li>
</ul>
<h3>Parameters for each type of model</h3>
<ul>
<li><p class="startli">**<code>x_dim</code>** (int, default: 12)</p>
<p class="startli">State dimension.</p>
</li>
<li><p class="startli">**<code>u_dim</code>** (int, default: 12)</p>
<p class="startli">Control dimension.</p>
</li>
<li><p class="startli">**<code>g_dim</code>** (int, default: 28)</p>
<p class="startli">Constraint dimension.</p>
</li>
<li><p class="startli">**<code>x_weights</code>** (vector, default: [5.0, 5.0, 5.0, 0.5, 0.5, 0.5, 0.1, 0.1, 0.2, 0.05, 0.05, 0.01])</p>
<p class="startli">State cost weights.</p>
</li>
<li><p class="startli">**<code>u_weights</code>** (vector, default: [!!float 5e-5, !!float 5e-5, !!float 5e-5, !!float 5e-5, !!float 5e-5, !!float 5e-5, !!float 5e-5, !!float 5e-5, !!float 5e-5, !!float 5e-5, !!float 5e-5, !!float 5e-5])</p>
<p class="startli">Control cost weights.</p>
</li>
<li><p class="startli">**<code>x_lb</code>** (vector, default: [!!float -2e19, !!float -2e19, 0, -3.14159, -3.14159, -3.14159, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19])</p>
<p class="startli">State lower bound.</p>
</li>
<li><p class="startli">**<code>x_ub</code>** (vector, default: [!!float 2e19, !!float 2e19, !!float 2e19, 3.14159, 3.14159, 3.14159, !!float 2e19, !!float 2e19, !!float 2e19, !!float 2e19, !!float 2e19, !!float 2e19])</p>
<p class="startli">State upper bound.</p>
</li>
<li><p class="startli">**<code>x_lb_soft</code>** (vector, default: [!!float -2e19, !!float -2e19, 0, -3.14159, -3.14159, -3.14159, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19])</p>
<p class="startli">Soft state lower bound.</p>
</li>
<li><p class="startli">**<code>x_ub_soft</code>** (vector, default: [!!float 2e19, !!float 2e19, !!float 2e19, 3.14159, 3.14159, 3.14159, !!float 2e19, !!float 2e19, !!float 2e19, !!float 2e19, !!float 2e19, !!float 2e19])</p>
<p class="startli">Soft state upper bound.</p>
</li>
<li><p class="startli">**<code>u_lb</code>** (vector, default: [!!float -2e19, !!float -2e19, 10, !!float -2e19, !!float -2e19, 10, !!float -2e19, !!float -2e19, 10, !!float -2e19, !!float -2e19, 10])</p>
<p class="startli">Control lower bound.</p>
</li>
<li><p class="startli">**<code>u_ub</code>** (vector, default: [!!float 2e19, !!float 2e19, 250, !!float 2e19, !!float 2e19, 250, !!float 2e19, !!float 2e19, 250, !!float 2e19, !!float 2e19, 250])</p>
<p class="startli">Control upper bound.</p>
</li>
<li><p class="startli">**<code>g_lb</code>** (vector, default: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19, !!float -2e19])</p>
<p class="startli">Constraint lower bound.</p>
</li>
<li><p class="startli">**<code>g_ub</code>** (vector, default: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])</p>
<p class="startli">Constraint upper bound.</p>
</li>
</ul>
<h1>Bugs &amp; Feature Requests</h1>
<p>Please report bugs and request features using the <a href="https://github.com/robomechanics/quad-sdk/issues">Issue Tracker</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>

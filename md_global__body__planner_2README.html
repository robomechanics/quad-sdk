<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Quad-SDK: Global Body Planner</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Quad-SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Global Body Planner</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Overview</h1>
<p>This package implements global planning algorithms for agile quadrupedal navigation. The package produces point-to-point plans which guide the robot from its current state to the goal given a map of the terrain. The primary navigation algorithm is the Global Body Planner for Legged Robots (GBP-L), an based RRT-Connect planner which uses mixed motion primitives to produce long-horizon plans that include flight phases. See the <a href="https://www.andrew.cmu.edu/user/amj1/papers/IROS2020_Fast_Global_Motion_Planning.pdf">paper</a> for more details on the algorithm.</p>
<h2>License</h2>
<p>The source code is released under a <a href="quad-sdk/LICENSE">MIT License</a>.</p>
<p>**Author: Joe Norby<br  />
 Affiliation: <a href="https://www.cmu.edu/me/robomechanicslab/">Robomechanics Lab</a><br  />
 Maintainers: Jiming Ren (<a href="#" onclick="location.href='mai'+'lto:'+'jim'+'in'+'gre'+'@a'+'ndr'+'ew'+'.cm'+'u.'+'edu'; return false;">jimin<span class="obfuscator">.nosp@m.</span>gre@<span class="obfuscator">.nosp@m.</span>andre<span class="obfuscator">.nosp@m.</span>w.cm<span class="obfuscator">.nosp@m.</span>u.edu</a>) and Joe Norby (<a href="#" onclick="location.href='mai'+'lto:'+'jno'+'rb'+'y@a'+'nd'+'rew'+'.c'+'mu.'+'ed'+'u'; return false;">jnorb<span class="obfuscator">.nosp@m.</span>y@an<span class="obfuscator">.nosp@m.</span>drew.<span class="obfuscator">.nosp@m.</span>cmu.<span class="obfuscator">.nosp@m.</span>edu</a>)**</p>
<p>The Global Body Planner package has been tested under <a href="http://www.ros.org">ROS</a> Melodic 18.04. This is research code, expect that it changes often and any fitness for a particular purpose is disclaimed.</p>
<h2>Publications</h2>
<p>If you use this work in an academic context, please cite the following publication(s):</p>
<ul>
<li>J. Norby and A. M. Johnson, “Fast global motion planning for dynamic legged robots,” in 2020 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS). IEEE, 2020, pp. 3829–3836. (<a href="https://www.andrew.cmu.edu/user/amj1/papers/IROS2020_Fast_Global_Motion_Planning.pdf">paper</a>) <pre class="fragment">  @inproceedings{Norby2020,
  title={Fast global motion planning for dynamic legged robots},
  author={Norby, Joseph and Johnson, Aaron M},
  booktitle={2020 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS)},
  pages={3829--3836},
  year={2020},
  organization={IEEE}
  }
</pre></li>
</ul>
<h2>Unit Tests</h2>
<p>Run the unit tests with </p><pre class="fragment">catkin run_tests global_body_planner
</pre> <h1>Usage</h1>
<p>Run the main node with </p><pre class="fragment">roslaunch quad_utils planning.launch reference:=gbpl
</pre><p> Leaping can be disabled with the optional argument <code>leaping:=false</code>, which internally skips the leap action sampling procedure and relaxes the kinematics bounds on collision checking.</p>
<h1>Config files</h1>
<ul>
<li><b>global_body_planner.yaml</b> Sets planning hyperparameters.</li>
</ul>
<h1>Nodes</h1>
<h2>global_body_planner</h2>
<p>Publishes global plans to guide lower layers towards the goal state. The node makes iterative calls to the planner from the current state to the desired goal state, and compares the result to the previous best plan. The new plan is accepted and published if one of the following is true:</p>
<ol type="1">
<li>The current plan reaches the goal and is shorter than the previous plan</li>
<li>The current plan gets closer to the goal than the previous plan</li>
<li>A new goal state has been set since the previous plan was constructed</li>
</ol>
<p>Internally the node alternates between two states to promote high-quality and feasible plans. Upon recieving a new goal state the node enters the <code>RESET</code> mode, which pauses and replans from the current state for a set amount of time (determined by <code>startup_delay</code>), after which it publishes the best plan and enters the <code>REFINE</code> mode. While in <code>REFINE</code>, it continuously replans from a point on the current plan <code>max_planning_time</code> seconds into the future to ensure the new plan will be valid.</p>
<h3>Subscribed Topics</h3>
<ul>
<li><p class="startli">**<code>/start_state</code>** ([quad_msgs/RobotState])</p>
<p class="startli">The current state of the robot. Typically remapped to <code>/state/ground_truth</code>.</p>
</li>
<li><p class="startli">**<code>/goal_state</code>** ([geometry_msgs/PointStamped])</p>
<p class="startli">The 2.5D height map with terrain information. Typically remapped to <code>/clicked_point</code> for RViz interaction.</p>
</li>
<li><p class="startli">**<code>/terrain_map</code>** ([grid_map_msgs/GridMap])</p>
<p class="startli">The 2.5D height map with terrain information.</p>
</li>
</ul>
<h3>Published Topics</h3>
<ul>
<li><p class="startli">**<code>/global_plan</code>** ([quad_msgs/RobotPlan])</p>
<p class="startli">The global plan consisting of interpolated robot states leading from the start to the goal state.</p>
</li>
<li><p class="startli">**<code>/global_plan_discrete</code>** ([quad_msgs/RobotPlan])</p>
<p class="startli">The discrete global plan consisting of the states within the underlying planning tree.</p>
</li>
</ul>
<h3>Parameters</h3>
<ul>
<li><p class="startli">**<code>update_rate</code>** (double, default: 20)</p>
<p class="startli">The update rate of the planner (in Hz).</p>
</li>
<li><p class="startli">**<code>num_calls</code>** (int, default: 1)</p>
<p class="startli">The number of times to call the planner each iteration.</p>
</li>
<li><p class="startli">**<code>max_planning_time</code>** (double, default: 0.25)</p>
<p class="startli">The maximum time (in s) the planner is allowed to search in one call, after which the path closest to the goal is returned.</p>
</li>
<li><p class="startli">**<code>goal_state</code>** (vector, default: [5.0, 0.0])</p>
<p class="startli">The nominal goal state (in x/y world frame coordinates) to be planned if none is provided via the topic. Assumes a desired final velocity of zero.</p>
</li>
<li><p class="startli">**<code>state_error_threshold</code>** (double, default: 25)</p>
<p class="startli">The position error (in m) between the current state and reference state which triggers <code>RESET</code> mode. Setting this to a sufficiently high value disables this feature.</p>
</li>
<li><p class="startli">**<code>startup_delay</code>** (double, default: 1.5)</p>
<p class="startli">The time (in s) spent replanning while in <code>RESET</code> mode before publishing a plan for execution.</p>
</li>
<li><p class="startli">**<code>replanning</code>** (boolean, default: true)</p>
<p class="startli">Enable or disable replanning.</p>
</li>
<li><p class="startli">**<code>dt</code>** (double, default: 0.03)</p>
<p class="startli">Timestep (in s) used for kinematics checks and interpolation.</p>
</li>
<li><p class="startli">**<code>trapped_buffer_factor</code>** (int, default: 7)</p>
<p class="startli">Number of timesteps that must be valid for a state-action pair to not be considered trapped.</p>
</li>
<li><p class="startli">**<code>backup_ratio</code>** (double, default: 0.5, min: 0, max: 1)</p>
<p class="startli">Fraction of state-action pair to back up if an invalid state is detected.</p>
</li>
<li><p class="startli">**<code>num_leap_samples</code>** (int, default: 10)</p>
<p class="startli">Number of leaps sampled per extend function call.</p>
</li>
<li><p class="startli">**<code>traversability_threshold</code>** (double, default: 0.3)</p>
<p class="startli">Traversability threshold for a feasible contact location to avoid regions of poor traversability. Making this smaller will make the robot more optimistic about regions it can traverse without leaping. Set to zero to disable.</p>
</li>
<li><p class="startli">**<code>mu</code>** (double, default: 0.25)</p>
<p class="startli">Friction coefficient.</p>
</li>
<li><p class="startli">**<code>g</code>** (double, default: 9.81)</p>
<p class="startli">Gravity acceleration.</p>
</li>
<li><p class="startli">**<code>t_s_min</code>** (double, default: 0.1)</p>
<p class="startli">Minimum leaping stance time.</p>
</li>
<li><p class="startli">**<code>t_s_max</code>** (double, default: 0.25)</p>
<p class="startli">Maximum leaping stance time.</p>
</li>
<li><p class="startli">**<code>dz0_min</code>** (double, default: 1.0)</p>
<p class="startli">Minimum vertical velocity impulse (in m/s) applied at the beginning of a leaping phase.</p>
</li>
<li><p class="startli">**<code>dz0_max</code>** (double, default: 2.0)</p>
<p class="startli">Maximum vertical velocity impulse (in m/s) applied at the beginning of a leaping phase.</p>
</li>
</ul>
<h1>Bugs &amp; Feature Requests</h1>
<p>Please report bugs and request features using the <a href="https://github.com/robomechanics/quad-sdk/issues">Issue Tracker</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
